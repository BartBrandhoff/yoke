<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-02-23 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150223" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Yoke micro-framework - Yoke</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="http://github.com/apache/maven-skins">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                                  <div class="container" style="width: 90%;"><div class="nav-collapse">
            
                
                                                                                <a class="brand" href="index.html" >

                                
                                    Yoke
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Middleware <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="middleware/basic-auth.html"  title="Basic Auth">Basic Auth</a>
</li>
                  
                      <li>      <a href="middleware/body-parser.html"  title="Body Parser">Body Parser</a>
</li>
                  
                      <li>      <a href="middleware/bridge-secure-handler.html"  title="Bridge Secure Handler">Bridge Secure Handler</a>
</li>
                  
                      <li>      <a href="middleware/compress.html"  title="Compress">Compress</a>
</li>
                  
                      <li>      <a href="middleware/cookie-parser.html"  title="Cookie Parser">Cookie Parser</a>
</li>
                  
                      <li>      <a href="middleware/cors.html"  title="CORS">CORS</a>
</li>
                  
                      <li>      <a href="middleware/csrf.html"  title="CSRF">CSRF</a>
</li>
                  
                      <li>      <a href="middleware/error-handler.html"  title="Error Handler">Error Handler</a>
</li>
                  
                      <li>      <a href="middleware/favicon.html"  title="Favicon">Favicon</a>
</li>
                  
                      <li>      <a href="middleware/form-auth.html"  title="Form Auth">Form Auth</a>
</li>
                  
                      <li>      <a href="middleware/jwt.html"  title="JWT">JWT</a>
</li>
                  
                      <li>      <a href="middleware/limit.html"  title="Limit">Limit</a>
</li>
                  
                      <li>      <a href="middleware/logger.html"  title="Logger">Logger</a>
</li>
                  
                      <li>      <a href="middleware/method-override.html"  title="Method Override">Method Override</a>
</li>
                  
                      <li>      <a href="middleware/request-proxy.html"  title="Request Proxy">Request Proxy</a>
</li>
                  
                      <li>      <a href="middleware/response-headers.html"  title="Response Headers">Response Headers</a>
</li>
                  
                      <li>      <a href="middleware/router.html"  title="Router">Router</a>
</li>
                  
                      <li>      <a href="middleware/session.html"  title="Session">Session</a>
</li>
                  
                      <li>      <a href="middleware/static.html"  title="Static">Static</a>
</li>
                  
                      <li>      <a href="middleware/timeout.html"  title="Timeout">Timeout</a>
</li>
                  
                      <li>      <a href="middleware/vhost.html"  title="VHost">VHost</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="tutorial/java.html"  title="Java">Java</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="license.html"  title="Project License">Project License</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="cobertura/index.html"  title="Cobertura Test Coverage">Cobertura Test Coverage</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
                                                                            
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Yoke micro-framework</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-02-23
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 2.0.13
                      </li>
                      
                
                    
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <h1><a href="/">Yoke</a></h1>
<div class="section">
<h2>JsonRestRouter<a name="JsonRestRouter"></a></h2>
<p>JsonRestRouter is a extra middleware module built specifically to enable you to build correct REST web services. It intentionally extends Yoke <a href="Router.html">Router</a> middleware as that is more or less the de facto API for writing web applications on top of Yoke.</p>
<p>In short, JsonRestRouter adds a data store backend to a router and implements all basic content negotiation (just JSON) and all the REST semantics.</p>
<p>There are 6 verbs:</p>

<ul>
  
<li><i>QUERY</i> - maps to HTTP GET /resource</li>
  
<li><i>READ</i> - maps to HTTP GET /resource/:id</li>
  
<li><i>UPDATE</i> - maps to HTTP PUT /resource/:id</li>
  
<li><i>APPEND</i> - maps to HTTP PATCH /resource/:id</li>
  
<li><i>CREATE</i> - maps to HTTP POST /resource</li>
  
<li><i>DELETE</i> - maps to HTTP DELETE /resource/:id</li>
</ul>
<p>In order to use JsonRestRouter you need to have a Store implementation (yoke extras) bundles a MongoDb store.</p></div>
<div class="section">
<h2>Create a REST resource<a name="Create_a_REST_resource"></a></h2>

<div class="source">
<pre>final Yoke yoke = new Yoke(vertx);

JsonObject persistorCfg = new JsonObject();
persistorCfg.putString(&quot;host&quot;, &quot;localhost&quot;);
persistorCfg.putNumber(&quot;port&quot;, 27017);
persistorCfg.putString(&quot;address&quot;, &quot;mongo.persons&quot;);
persistorCfg.putString(&quot;db_name&quot;, &quot;yoke-extras&quot;);

final EventBus eb = vertx.eventBus();

// deploy mongo module
container.deployModule(&quot;io.vertx~mod-mongo-persistor~2.0.0-beta1&quot;, persistorCfg);

// db access
final MongoDbStore db = new MongoDbStore(eb, &quot;mongo.persons&quot;);

JsonRestRouter router = new JsonRestRouter(db);
router.rest(&quot;/persons&quot;, &quot;persons&quot;);
yoke.use(router);
yoke.listen(8080);

container.logger().info(&quot;Yoke server listening on port 8080&quot;);
</pre></div>
<p>All you need to define is a Database store and after create a router with at least 2 arguments:</p>

<ul>
  
<li>resource - the root resource for the REST call (e.g.: <i>/persons</i>)</li>
  
<li>entityName - the entity name, in mongoDb terms this is the collection name (e.g.: <i>persons</i>)</li>
  
<li>allowedVerbs - a sum of all verbs as described before, or in case of not specified all are included</li>
</ul></div>
<div class="section">
<h2>Create a entity<a name="Create_a_entity"></a></h2>
<p>Request:</p>

<div class="source">
<pre>POST /persons HTTP/1.1
Content-Type: application/json

{&quot;name&quot;:&quot;Paulo&quot;}
</pre></div>
<p>Response:</p>

<div class="source">
<pre>HTTP/1.1 201
X-Powered-By: yoke
Location: /persons/e9a1f835-28c2-4f18-9816-747a77a98234
Content-Length: 0
</pre></div></div>
<div class="section">
<h2>List all entities<a name="List_all_entities"></a></h2>
<p>Request:</p>

<div class="source">
<pre>GET /persons HTTP/1.1
</pre></div>
<p>Response:</p>

<div class="source">
<pre>HTTP/1.1 200
x-powered-by	yoke
content-type	application/json
Content-Length	63

[{&quot;_id&quot;:&quot;e9a1f835-28c2-4f18-9816-747a77a98234&quot;,&quot;name&quot;:&quot;Paulo&quot;}]
</pre></div></div>
<div class="section">
<h2>List one entity<a name="List_one_entity"></a></h2>
<p>Request:</p>

<div class="source">
<pre>GET /persons/e9a1f835-28c2-4f18-9816-747a77a98234 HTTP/1.1
</pre></div>
<p>Response:</p>

<div class="source">
<pre>HTTP/1.1 200
x-powered-by	yoke
content-type	application/json
Content-Length	61

{&quot;_id&quot;:&quot;e9a1f835-28c2-4f18-9816-747a77a98234&quot;,&quot;name&quot;:&quot;Paulo&quot;}
</pre></div></div>
<div class="section">
<h2>Append<a name="Append"></a></h2>
<p>Request:</p>

<div class="source">
<pre>PATCH /persons/e9a1f835-28c2-4f18-9816-747a77a98234 HTTP/1.1
Content-Type: application/json

{&quot;username&quot;:&quot;pmlopes&quot;}
</pre></div>
<p>Response:</p>

<div class="source">
<pre>HTTP/1.1 204
x-powered-by	yoke
Content-Length	0
</pre></div></div>
<div class="section">
<h2>Update<a name="Update"></a></h2>
<p>Request:</p>

<div class="source">
<pre>PUT /persons/e9a1f835-28c2-4f18-9816-747a77a98234 HTTP/1.1
Content-Type: application/json

{&quot;name&quot;: &quot;Paulo Lopes&quot;, &quot;username&quot;:&quot;pmlopes&quot;}
</pre></div>
<p>Response:</p>

<div class="source">
<pre>HTTP/1.1 204
x-powered-by	yoke
Content-Length	0
</pre></div></div>
<div class="section">
<h2>Delete<a name="Delete"></a></h2>
<p>Request:</p>

<div class="source">
<pre>DELETE /persons/e9a1f835-28c2-4f18-9816-747a77a98234 HTTP/1.1
</pre></div>
<p>Response:</p>

<div class="source">
<pre>HTTP/1.1 204
x-powered-by	yoke
Content-Length	0
</pre></div></div>
<div class="section">
<h2>Validation<a name="Validation"></a></h2>
<p>Of course one cannot create a service and expect the data received from the network is always valid, in case we need to validate the data. In order to achieve this one can use the ValidationStore class. The ValidationStore class wraps a store and allows you to override any of the crud operations:</p>

<ul>
  
<li>create</li>
  
<li>read</li>
  
<li>update</li>
  
<li>delete</li>
  
<li>query</li>
  
<li>count</li>
</ul>
<p>either before or after the database round trip. In order to do this just override either:</p>

<ul>
  
<li>beforeCreate</li>
  
<li>beforeRead</li>
  
<li>beforeUpdate</li>
  
<li>beforeDelete</li>
  
<li>beforeQuery</li>
  
<li>beforeCount</li>
</ul>
<p>or:</p>

<ul>
  
<li>afterCreate</li>
  
<li>afterRead</li>
  
<li>afterUpdate</li>
  
<li>afterDelete</li>
  
<li>afterQuery</li>
  
<li>afterCount</li>
</ul>
<p>By default the validation store will assume success, so you only need to override the methods you really need.</p></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
                      <div class="row">
                              <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

        
                <p id="poweredBy" class="pull-right">
                          <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
              </p>
        
                </div>
    </footer>
        </body>
</html>
