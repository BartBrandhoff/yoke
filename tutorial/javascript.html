<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-02-23 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150223" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Yoke micro-framework - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="http://github.com/apache/maven-skins">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                                  <div class="container" style="width: 90%;"><div class="nav-collapse">
            
                
                                                                                <a class="brand" href="../index.html" >

                                
                                    Yoke
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Middleware <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../middleware/basic-auth.html"  title="Basic Auth">Basic Auth</a>
</li>
                  
                      <li>      <a href="../middleware/body-parser.html"  title="Body Parser">Body Parser</a>
</li>
                  
                      <li>      <a href="../middleware/bridge-secure-handler.html"  title="Bridge Secure Handler">Bridge Secure Handler</a>
</li>
                  
                      <li>      <a href="../middleware/compress.html"  title="Compress">Compress</a>
</li>
                  
                      <li>      <a href="../middleware/cookie-parser.html"  title="Cookie Parser">Cookie Parser</a>
</li>
                  
                      <li>      <a href="../middleware/cors.html"  title="CORS">CORS</a>
</li>
                  
                      <li>      <a href="../middleware/csrf.html"  title="CSRF">CSRF</a>
</li>
                  
                      <li>      <a href="../middleware/error-handler.html"  title="Error Handler">Error Handler</a>
</li>
                  
                      <li>      <a href="../middleware/favicon.html"  title="Favicon">Favicon</a>
</li>
                  
                      <li>      <a href="../middleware/form-auth.html"  title="Form Auth">Form Auth</a>
</li>
                  
                      <li>      <a href="../middleware/jwt.html"  title="JWT">JWT</a>
</li>
                  
                      <li>      <a href="../middleware/limit.html"  title="Limit">Limit</a>
</li>
                  
                      <li>      <a href="../middleware/logger.html"  title="Logger">Logger</a>
</li>
                  
                      <li>      <a href="../middleware/method-override.html"  title="Method Override">Method Override</a>
</li>
                  
                      <li>      <a href="../middleware/request-proxy.html"  title="Request Proxy">Request Proxy</a>
</li>
                  
                      <li>      <a href="../middleware/response-headers.html"  title="Response Headers">Response Headers</a>
</li>
                  
                      <li>      <a href="../middleware/router.html"  title="Router">Router</a>
</li>
                  
                      <li>      <a href="../middleware/session.html"  title="Session">Session</a>
</li>
                  
                      <li>      <a href="../middleware/static.html"  title="Static">Static</a>
</li>
                  
                      <li>      <a href="../middleware/timeout.html"  title="Timeout">Timeout</a>
</li>
                  
                      <li>      <a href="../middleware/vhost.html"  title="VHost">VHost</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../tutorial/java.html"  title="Java">Java</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="../project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                                  <li>      <a href="../team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="../integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="../issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="../license.html"  title="Project License">Project License</a>
</li>
                                  <li>      <a href="../source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="../project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="../testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="../cobertura/index.html"  title="Cobertura Test Coverage">Cobertura Test Coverage</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
                                                                            
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Yoke micro-framework</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-02-23
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 2.0.13
                      </li>
                      
                
                    
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <p>There are several options on creating projects for Java. In this tutorial the chosen method is using <a class="externalLink" href="http://www.gradle.org/">Gradle</a>. The choice was made because there is no required installation of software (as long as you have <i>JDK &gt;= 1.7</i> installed in your system.</p>
<p>It is assumed that the reader has basic knowledge of <i>git</i>, <i>shell</i> scripting and of course <i>Java</i>. You are not required to know <i>gradle</i> since we are using this template project.</p>
<p>Start by downloading the <a href="yoke-gradle-template.tar.gz">yoke-gradle-template</a> to your local development work directory.</p>

<div class="source">
<pre>pmlopes@jetdrone:~/Projects$ curl -0 http://pmlopes.github.io/yoke/yoke-gradle-template.tar.gz | tar -zx
pmlopes@jetdrone:~/Projects$
</pre></div>
<p>The extracted project lives under the directory <i>yoke-gradle-template</i> it should be expected to be renamed to a better suitable name describing the project to be implemented.</p>

<div class="source">
<pre>pmlopes@jetdrone:~/Projects$ mv yoke-gradle-template yoke-tutorial
pmlopes@jetdrone:~/Projects$ cd yoke-tutorial
pmlopes@jetdrone:~/Projects/yoke-tutorial$
</pre></div>
<div class="section">
<h2>Introduction<a name="Introduction"></a></h2>
<p>Yoke is a minimal and flexible Vert.x web application framework, providing a robust set of features for building single and multi-page, and hybrid web applications. Yoke provides a thin layer of features fundamental to any web application, without obscuring features that you know and love in Vert.x.</p>
<p>Before you start, you need to understand the basic functionality under Yoke. Yoke is a chain executor, modelled in a way like the <a class="externalLink" href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain-of-responsability pattern</a>. Yoke is responsible to execute all your processing objects, which from now on we call Middleware. Middleware makes it easier for software developers to perform specialized tasks, such as <i>HTTP Parsing</i>, <i>Authentication</i>, <i>Routing</i>, etc&#x2026;, so they can focus on the specific purpose of their application.</p>
<p>The API of Yoke is quite simple, in fact it consist only of 4 methods:</p>

<ul>
  
<li><tt>use</tt></li>
  
<li><tt>set</tt></li>
  
<li><tt>engine</tt></li>
  
<li><tt>listen</tt></li>
</ul>
<div class="section">
<h3>use<a name="use"></a></h3>
<p>You register middleware onto it using the <tt>use</tt> method, you might call the method with the following signatures:</p>

<div class="source">
<pre>// Adds a Middleware (either from Yoke Middleware collection or your own to the chain.
// This middleware will run on every request path
use(Function middlewareImplementation);

// Adds a Middleware (either from Yoke Middleware collection or your own to the chain.
// This middleware will run only on requests which path starts with the route you specify. A tipical use case is when
// you want to do authentication on a specific route e.g.: all requests starting with /secure
use(String route, Function middlewareImplementation);
</pre></div>
<p>You can registeras many middleware as you want, but keep in mind that the order you used to register is the order that is used to process a request. In other words If you need to consume the request body of a request you need to use the <a href="BodyParser.html">BodyParser</a> middleware before the middleware you are implementing.</p>
<p>The difference between the Middleware abstract class and the <a class="externalLink" href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain-of-responsability pattern</a> is that you don&#x2019;t have to define the &#x201c;next&#x201d; on the middleware itself but yoke takes care of it. An implementation of Middleware requires you to implement the following function:</p>

<div class="source">
<pre>/**
 * Handles a request.
 *
 * @param request A YokeRequest which in practice is a extended HttpServerRequest
 * @param next The callback to inform that the next middleware in the chain should be used. A value different from
 *             null represents an error and in that case the error handler middleware will be executed.
 */
function (request, next) {};
</pre></div>
<p>The <tt>next</tt> parameter is a <a class="externalLink" href="http://en.wikipedia.org/wiki/Callback_%28computer_programming%29">callback</a>. The reason for using callbacks is to allow asynchronous execution of tasks. So in your code you can call <tt>next(object)</tt> in the end of your method, or if you need to wait for some asynchronous call then at that moment you can call the callback.</p>
<p>The value you pass to the callback is an <i>Error</i>. It might feel strange that the callback accepts <i>Object</i> instead of <i>Exception</i> but the reason is that sometimes you might want to raise errors that do not require a full stack trace to be generated by the JVM. In those cases you just pass a <i>Number</i> which is interpreted as a <a class="externalLink" href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes"><i>HTTP Error</i></a>. When a <i>String</i> is passed, then a generic <i>Internal Server Error</i> is raised. If your middleware completed successfuly then your error should be <i>null</i>.</p>
<p>To signal the end of processing of a request, just don&#x2019;t call the callback handler anymore. To summarize, calling next informs Yoke to execute the next <i>Middleware</i> in the chain, if the handler contains anything other than <i>null</i> then an error middleware is executed skipping all the remaining middleware.</p></div>
<div class="section">
<h3>set<a name="set"></a></h3>
<p>Every YokeRequest contains a context. A context is just a Java <a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/util/Map.html">Map</a>. The context is how you can share data between middlewares and lives during the request lifetime. When a request arrives at Yoke the context is initialized with an empty Map and all the values you define on Yoke with the <tt>set</tt> method. Yoke always defines the key <i>title</i> with the value <i>Yoke</i>. You might want to override this by setting the title to your application name.</p></div>
<div class="section">
<h3>engine<a name="engine"></a></h3>
<p>Yoke allows you to use template engines so you do not need to generate <i>HTML</i> by appending strings. You register an engine but registering it&#x2019;s extension and a class that extends the Engine abstract class. By default Yoke bundles a simple <i>GroovyTemplate</i> that allows you to use the powerful GroovyTemplate class as a html generator.</p>
<p>Of course this is a very naive engine so you can add your own or use other ones provided by the community. If you need to implement one yourself all you need to implement is the following method:</p>

<div class="source">
<pre>/**
 * The required to implement method.
 *
 * @param filename - String representing the file path to the template
 * @param context - Map with key values that might get substituted in the template
 * @param handler - The future result handler with a Buffer in case of success
 */
public void render(String filename, Map&lt;String, Object&gt; context, AsyncResultHandler&lt;String&gt; handler);
</pre></div>
<p>The context is passed from the request directly and in fact is the same Map that was described on the <tt>set</tt> method.</p>
<p>To use the engines all you need to do is use the <tt>render</tt> method on the YokeResponse and pass the filename with the correct file extension used to register the engine.</p></div>
<div class="section">
<h3>listen<a name="listen"></a></h3>
<p>With this method you start a server, either listening on a specific port, address + port, or on top of an existing Vert.x HttpServer.</p></div></div>
<div class="section">
<h2>Hello World<a name="Hello_World"></a></h2>
<p>At this moment you should understand the basic API of Yoke, and how it works so it is time to write your first <i>Hello World</i> example.</p>
<p>Assuming you already bootstraped your project and are inside the working directory we are going to create the groovy script: <tt>HelloWorldVerticle.js</tt> under <tt>src/main/resources</tt>. At this moment you should have the file <tt>src/main/resources/HelloWorldVerticle.js</tt> in your file system.</p>
<p>The reason we have a <i>Verticle</i> class is because Yoke does not forces you to use any special classes, you still code like you would on Vert.x. So we start by creating a Verticle the same way we would on any other Vert.x application:</p>

<div class="source">
<pre>console.log(&quot;Nothing here!&quot;);
</pre></div>
<p>This is the bare minimal Verticle code you need to write. Of course this code does not do anything fancy, in fact it just do nothing. So lets make a <i>HTTP</i> web server that listens on port <i>8080</i>.</p>

<div class="source">
<pre>var Yoke = require('yokejs/Yoke');

var yoke = new Yoke();
yoke.listen(8080);
</pre></div>
<p>And you can quickly test your new Verticle by running:</p>

<div class="source">
<pre>pmlopes@jetdrone:~/Projects/yoke-tutorial$ ./gradlew runMod
pmlopes@jetdrone:~/Projects/yoke-tutorial$
</pre></div>
<p>If you open a web browser and navigate to your localhost at port 8080 you will get a <i>404</i> <i>Not Found</i> error message. This is expected since you have a server running but no middleware is handling your requests. So lets install a handler for all request paths to respond with &#x201c;Hello World&#x201d;.</p>

<div class="source">
<pre>var Yoke = require('yokejs/Yoke');

var yoke = new Yoke();
yoke.use(function (req) {
  req.response().end('Hello World!');
});
yoke.listen(8080);
</pre></div>
<p>If you restart your verticle running the gradle command from before and reload your web browser you will see the text &#x201c;Hello World&#x201d; on it.</p></div>
<div class="section">
<h2>REST<a name="REST"></a></h2></div>
<div class="section">
<h2>Error Handling<a name="Error_Handling"></a></h2></div>
<div class="section">
<h2>Templates<a name="Templates"></a></h2></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
                      <div class="row">
                              <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

        
                <p id="poweredBy" class="pull-right">
                          <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
              </p>
        
                </div>
    </footer>
        </body>
</html>
