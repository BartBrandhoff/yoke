<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-02-23 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150223" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Yoke micro-framework - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="http://github.com/apache/maven-skins">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                                  <div class="container" style="width: 90%;"><div class="nav-collapse">
            
                
                                                                                <a class="brand" href="../index.html" >

                                
                                    Yoke
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Middleware <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../middleware/basic-auth.html"  title="Basic Auth">Basic Auth</a>
</li>
                  
                      <li>      <a href="../middleware/body-parser.html"  title="Body Parser">Body Parser</a>
</li>
                  
                      <li>      <a href="../middleware/bridge-secure-handler.html"  title="Bridge Secure Handler">Bridge Secure Handler</a>
</li>
                  
                      <li>      <a href="../middleware/compress.html"  title="Compress">Compress</a>
</li>
                  
                      <li>      <a href="../middleware/cookie-parser.html"  title="Cookie Parser">Cookie Parser</a>
</li>
                  
                      <li>      <a href="../middleware/cors.html"  title="CORS">CORS</a>
</li>
                  
                      <li>      <a href="../middleware/csrf.html"  title="CSRF">CSRF</a>
</li>
                  
                      <li>      <a href="../middleware/error-handler.html"  title="Error Handler">Error Handler</a>
</li>
                  
                      <li>      <a href="../middleware/favicon.html"  title="Favicon">Favicon</a>
</li>
                  
                      <li>      <a href="../middleware/form-auth.html"  title="Form Auth">Form Auth</a>
</li>
                  
                      <li>      <a href="../middleware/jwt.html"  title="JWT">JWT</a>
</li>
                  
                      <li>      <a href="../middleware/limit.html"  title="Limit">Limit</a>
</li>
                  
                      <li>      <a href="../middleware/logger.html"  title="Logger">Logger</a>
</li>
                  
                      <li>      <a href="../middleware/method-override.html"  title="Method Override">Method Override</a>
</li>
                  
                      <li>      <a href="../middleware/request-proxy.html"  title="Request Proxy">Request Proxy</a>
</li>
                  
                      <li>      <a href="../middleware/response-headers.html"  title="Response Headers">Response Headers</a>
</li>
                  
                      <li>      <a href="../middleware/router.html"  title="Router">Router</a>
</li>
                  
                      <li>      <a href="../middleware/session.html"  title="Session">Session</a>
</li>
                  
                      <li>      <a href="../middleware/static.html"  title="Static">Static</a>
</li>
                  
                      <li>      <a href="../middleware/timeout.html"  title="Timeout">Timeout</a>
</li>
                  
                      <li>      <a href="../middleware/vhost.html"  title="VHost">VHost</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../tutorial/java.html"  title="Java">Java</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="../project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                                  <li>      <a href="../team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="../integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="../issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="../license.html"  title="Project License">Project License</a>
</li>
                                  <li>      <a href="../source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="../project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="../apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="../testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="../cobertura/index.html"  title="Cobertura Test Coverage">Cobertura Test Coverage</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
                                                                            
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Yoke micro-framework</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-02-23
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 2.0.13
                      </li>
                      
                
                    
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <p>Yoke is a minimal and flexible Vert.x web application framework, providing a robust set of features for building single and multi-page, and hybrid web applications. Yoke provides a thin layer of features fundamental to any web application, without obscuring features that you know and love in Vert.x.</p>
<p>Before you start, you need to understand the basic functionality under Yoke. Yoke is a chain executor, modelled in a way like the <a class="externalLink" href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain-of-responsability pattern</a>. Yoke is responsible to execute all your processing objects, which from now on we call Middleware. Middleware makes it easier for software developers to perform specialized tasks, such as <i>HTTP Parsing</i>, <i>Authentication</i>, <i>Routing</i>, etc&#x2026;, so they can focus on the specific purpose of their application.</p>
<p>The API of Yoke is quite simple, in fact it consist only of 7 methods:</p>

<ul>
  
<li><tt>engine</tt> - API to register render engines. A render engine is a simple interface to a template engine, by default  Yoke ships with a simple placeholder replacer, however there are implementations for other popular template languages  like:
  
<ul>
    
<li><tt>jade</tt></li>
    
<li><tt>handlebars</tt></li>
    
<li><tt>mvel</tt></li>
    
<li><tt>thymeleaf</tt></li>
  </ul></li>
  
<li><tt>store</tt> - API to register storage engines. A storage engine is a interface to keep session data, currently there  are the following storage backends:
  
<ul>
    
<li><tt>SharedDataSessionStore</tt> - Backend backed by Vert.x <tt>SharedData</tt>. Currently this backend has a limitation  that the data is only shared in the same JVM, not across the cluster, however this is a implementation limitation  of the Vert.x API not of the backend.</li>
    
<li><tt>RedisSessionStore</tt> - Backend backed by a <a class="externalLink" href="http://www.redis.io">redis</a> server.</li>
    
<li><tt>MongoDbSessionStore</tt> - Backend backed by a <a class="externalLink" href="http://www.mongodb.org">mongodb</a> server.</li>
  </ul></li>
  
<li><tt>set</tt> - API to store any value in the global context. Configuration properties, etc&#x2026;.</li>
  
<li><tt>use</tt> - API to add <tt>Middleware</tt> to the chain. This is the method that you will need to use more often, the  order that the middleware is executed is the same as the registration.</li>
  
<li><tt>listen</tt> - API to bind this application to a HttpServer, either <tt>HTTP</tt> or <tt>HTTPS</tt>.</li>
  
<li><tt>deploy</tt> - Helper API to deploy other modules in order to facilitate beter development of Vert.x applications.</li>
  
<li><tt>security</tt> - API to handle all sort of encryption, such as provide cyphers to cookie parsers, decode web tokens,  etc&#x2026;</li>
</ul>
<div class="section">
<h2>Middleware<a name="Middleware"></a></h2>
<p>Middleware is the unit of work for Yoke, a <tt>Middleware</tt> is simply a class that implements the <tt>Middleware</tt> interface. The interface defines the following methods:</p>

<ul>
  
<li><tt>handle(YokeRequest request Handler&lt;Object&gt; next)</tt> - This is the main method that needs to be implemented. The  input is the current request wrapped in the class <tt>YokeRequest</tt> and a callback handler <tt>next</tt>.</li>
</ul>
<p>There are some extra methods available as helpers to get direct access to <tt>Vert.x</tt>, <tt>FileSystem</tt>, <tt>YokeSecurity</tt> and do some runtime initialization. By default Middleware registered directly to Yoke will run in the same execution run of the request unless a asynchronous call is made in between, Middleware registered to other Middleware containers such as <tt>Router</tt> is run in a asynchronous way. This last bit is quite important for some Middleware such as <tt>BodyParser</tt> which needs to setup the request and Vert.x to parse the data as soon as possible.</p></div>
<div class="section">
<h2>Engine<a name="Engine"></a></h2>
<p>Engine represents a Template Engine that can be registered with Yoke. Any template engine just needs to implement this template. The class provides access to the Vertx object so the engine might do I/O operations in the context of the module.</p>
<p>Variables are passed to the engine from 2 sources:</p>

<ul>
  
<li><tt>globals</tt> - globals are set on yoke itself using the <tt>set(String, Object)</tt> method.</li>
  
<li><tt>context</tt> - context variables are added to the request itself. The <tt>YokeRequest</tt> object contains the methods:
  
<ul>
    
<li><tt>put(String, Object)</tt> - puts a value in the context (which can shadow global context values)</li>
    
<li><tt>get(String)</tt> - gets a value from the context and when not found can get them from the global context</li>
  </ul></li>
</ul>
<p>The base framework contains a simple string placeholder engine that recognizes variables using the format: <tt>${variable}</tt>. Variable also allow composition for more complex scenarios: such as: <tt>${my${var}}</tt>.</p>
<p>Of course this is a very simple and naive engine suitable for very simple situations, however if you need something more powerful, you can use:</p>

<ul>
  
<li><tt>Jade4JEngine</tt> - Use the <a class="externalLink" href="http://jade-lang.com/">jade-lang</a> template language.</li>
  
<li><tt>HandlebarsEngine</tt> - Use the <a class="externalLink" href="http://handlebarsjs.com/">handlebars.js</a> template language.</li>
  
<li><tt>MVEL</tt> - Use the <a class="externalLink" href="https://github.com/mvel/mvel">MVEL</a> template language.</li>
  
<li><tt>thymeleaf</tt> - <i>EXPERIMENTAL</i> Use the <a class="externalLink" href="http://www.thymeleaf.org/">thmeleaf</a> template language.</li>
</ul></div>
<div class="section">
<h2>Store<a name="Store"></a></h2>
<p>Sometimes there is a need to store data across your cluster and you don&#x2019;t need to specify a database connection, a use case for storage engines are session stores where the session data is stored and needs to be in sync across all instances of your Vert.x app. The simplest store engine is <tt>SharedDataSessionStore</tt>, this store uses the native Vert.x <tt>SharedData</tt> class to handle all the storage related tasks. However <tt>SharedData</tt> has the limitation of not synchronizing across the Vert.x cluster, for this you need to use either:</p>

<ul>
  
<li><tt>RedisSessionStore</tt> - Requires a Redis server in your network plus the redis module.</li>
  
<li><tt>MongoDBSessionStore</tt> - Requires a MongoDB server in your network plus the mongo connector module.</li>
</ul></div>
<div class="section">
<h2>Bootstrap a Java Project<a name="Bootstrap_a_Java_Project"></a></h2>
<p>The easiest way to get started with Yoke is to bootstrap a project. Yoke support project skeletons using <a class="externalLink" href="http://www.gradle.org">Grade</a> 1.x. In order to use this feature you need to download the jar file from maven manually for the first time <a class="externalLink" href="https://repo1.maven.org/maven2/com/jetdrone/yoke/2.0.4/yoke-2.0.4.jar">yoke-2.0.4.jar</a>. Once you have this file in your computer bootstraping a java project is as simple as:</p>

<div class="source">
<pre>java -jar yoke-2.0.4.jar --java &lt;group&gt;:&lt;artifact&gt;:&lt;version&gt;
</pre></div>
<p>Where <tt>group</tt> is usually your reverse domain name, <tt>artifact</tt> your project name and <tt>version</tt> the version of your project. For example:</p>

<div class="source">
<pre>java -jar yoke-2.0.4.jar --java com.jetdrone:hello:1.0
</pre></div>
<p>Will result in the following:</p>

<div class="source">
<pre>   create : hello
   create : hello/README.md
   create : hello/gradle.properties
   create : hello/conf.json
   create : hello/LICENSE.txt
   create : hello/gradlew.bat
   create : hello/gradlew
   create : hello/build.gradle
   create : hello/gradle
   create : hello/gradle/vertx.gradle
   create : hello/gradle/setup.gradle
   create : hello/gradle/maven.gradle
   create : hello/gradle/wrapper
   create : hello/gradle/wrapper/gradle-wrapper.properties
   create : hello/gradle/wrapper/gradle-wrapper.jar
   create : hello/src/main/java
   create : hello/src/main/java/com/jetdrone/hello
   create : hello/src/main/java/com/jetdrone/hello/App.java
   create : hello/src/main/resources
   create : hello/src/main/resources/public
   create : hello/src/main/resources/public/stylesheets
   create : hello/src/main/resources/public/stylesheets/style.css
   create : hello/src/main/resources/views
   create : hello/src/main/resources/views/index.shtml
   create : hello/src/main/resources/mod.json
   create : hello/src/test/java
   create : hello/src/test/java/com/jetdrone/hello
   create : hello/src/test/java/com/jetdrone/hello/AppTest.java
   create : hello/src/test/resources

Go to your new app:
  cd hello

Compile your app:
  ./gradlew build

Run your app:
  ./gradlew runMod
</pre></div></div>
<div class="section">
<h2>Step by Step simple App<a name="Step_by_Step_simple_App"></a></h2>
<p>At this moment you should have the file <tt>src/main/java/com/jetdrone/hello/App.java</tt> in your file system. A close inspection to the generated code shows that you have <i>Verticle</i> class. The reason we have a <i>Verticle</i> class is because Yoke does not forces you to use any special classes, you still code like you would on Vert.x.</p>
<p>The generated code enables the StringPlaceholderEngine and then enables some middleware to show what you can do. If you want to start from scratch, of course you can just start with a simple Verticle.</p>
<p>So we start by creating a Verticle the same way we would on any other Vert.x application:</p>

<div class="source">
<pre>package com.jetdrone.hello;

import com.jetdrone.vertx.yoke.*;
import com.jetdrone.vertx.yoke.middleware.*;

import org.vertx.java.core.*;
import org.vertx.java.platform.*;

public class App extends Verticle {
  public void start() {
    ...
  }
}
</pre></div>
<p>This is the bare minimal Verticle code you need to write. Of course this code does not do anything fancy, in fact it just do nothing. So lets make a <i>HTTP</i> web server that listens on port <i>8080</i>.</p>

<div class="source">
<pre>...
  public void start() {
    Yoke yoke = new Yoke(vertx);
    yoke.listen(8080);
  }
...
</pre></div>
<p>At this point you have almost everything needed to run your verticle, the only missing item is the module descriptor. The module descriptor is a simple <i>JSON</i> file that describes the main verticle and any other metadata required for your verticle.</p>
<p>For this example we only need to define 2 entries, the <i>main</i> verticle class and the dependency on <i>Yoke</i>. Create a file under <tt>src/main/resources/mod.json</tt> with the following content:</p>

<div class="source">
<pre>{
  &quot;main&quot;: &quot;com.jetdrone.hello.App&quot;,
  &quot;includes&quot;: &quot;com.jetdrone~yoke~2.0.4&quot;
}
</pre></div>
<p>And you can quickly test your new Verticle by running:</p>

<div class="source">
<pre>$ ./gradlew runMod
</pre></div>
<p>If you open a web browser and navigate to your localhost at port 8080 you will get a <i>404</i> <i>Not Found</i> error message. This is expected since you have a server running but no middleware is handling your requests. So lets install a handler for all request paths to respond with &#x201c;Hello World&#x201d;.</p>

<div class="source">
<pre>...
  public void start() {
    Yoke yoke = new Yoke(vertx);
    yoke.use(new Handler&lt;YokeRequest&gt;() {
      @Override
      public void handle(YokeRequest request) {
        request.response().end(&quot;Hello World!&quot;);
      }
    });
    yoke.listen(8080);
  }
...
</pre></div>
<p>If you restart your verticle running the gradle command from before and reload your web browser you will see the text &#x201c;Hello World&#x201d; on it.</p></div>
<div class="section">
<h2>Routing<a name="Routing"></a></h2>
<p>More complex routing can be acomplished with the <tt>Router</tt> Middleware. This middleware has a method for each HTTP verb where you can register either a <tt>Pattern</tt> or a <tt>String</tt> path and a Middleware implementation.</p>

<ul>
  
<li><tt>GET</tt></li>
  
<li><tt>PUT</tt></li>
  
<li><tt>POST</tt></li>
  
<li><tt>DELETE</tt></li>
  
<li><tt>OPTIONS</tt></li>
  
<li><tt>HEAD</tt></li>
  
<li><tt>TRACE</tt></li>
  
<li><tt>CONNECT</tt></li>
  
<li><tt>PATCH</tt></li>
</ul>
<p>When you register a <tt>Pattern</tt> if a request <tt>path</tt> matches then the middleware is executed. When you use the <tt>String</tt> format some extra helpers are available. The <tt>String</tt> format is of the form: <tt>/path/:variable</tt>. When you use the style <tt>:variable</tt> some bootstrap is done behind the scenes where a regular expression is set to catch the value, this requires that the variable value follows the format: <tt>:([A-Za-z][A-Za-z0-9_]*)</tt>.</p>
<p>Behind the scenes the <tt>Router</tt> middleware will also catch the value from the variable and set it on the <tt>Context</tt> so you can access it using <tt>request.get(&quot;variable&quot;)</tt>.</p>
<p>Requests can be validated using the <tt>Router</tt> <tt>param()</tt> method. If a param is registered and matches the variable name from a HTTP method the validation is executed before the Middleware is called, and in case of failure an default error <tt>400</tt> (Bad Request) is returned.</p></div>
<div class="section">
<h2>Testing<a name="Testing"></a></h2>
<p>The generated code also created a simple JUnit test. Yoke includes a <tt>YokeTester</tt> class that helps you write tests without having to fully bootstrap a server, this makes testing your APIs simple as calling a method and inspect the generated result.</p>

<div class="source">
<pre>public class AppTest extends TestVerticle {

  @Test
  public void testApp() {
    final Yoke yoke = new Yoke(this);
    yoke.use(new Middleware() {
      @Override
      public void handle(YokeRequest request, Handler&lt;Object&gt; next) {
        request.response().end(&quot;OK&quot;);
      }
    });

    final YokeTester yokeAssert = new YokeTester(yoke);

    yokeAssert.request(&quot;GET&quot;, &quot;/&quot;, new Handler&lt;Response&gt;() {
      @Override
      public void handle(Response response) {
        assertEquals(&quot;OK&quot;, response.body.toString());
        testComplete();
      }
    });
  }
}
</pre></div></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
                      <div class="row">
                              <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

        
                <p id="poweredBy" class="pull-right">
                          <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
              </p>
        
                </div>
    </footer>
        </body>
</html>
